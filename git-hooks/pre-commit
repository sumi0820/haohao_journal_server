#!/bin/sh

echo "Running pre-commit checks..."

# プロジェクトのルートディレクトリに移動
cd "$(git rev-parse --show-toplevel)"

# フォーマットチェック
echo "Running ktlint format check..."
./gradlew ktlintFormat

# コード品質チェック
echo "Running detekt check..."
./gradlew detekt

# テスト実行
echo "Running tests..."
./gradlew test

# エラーが発生した場合の処理
if [ $? -ne 0 ]; then
    echo "❌ Pre-commit checks failed. Please fix the issues before committing."
    echo "For more details, check the build output above."
    echo "If you need help, please refer to the error messages and consider possible solutions."
    exit 1
fi

echo "✅ All pre-commit checks passed!"
exit 0
